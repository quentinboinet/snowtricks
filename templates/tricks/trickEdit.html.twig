{% extends 'base.html.twig' %}

{% block title %}{{ trick.name }} : modifications{% endblock %}

{% block body %}

    {{ parent() }}

    <!-- modal pour affichage du message de confirmation suppression image  -->
    <div class="modal fade" id="pictureDeletedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    Image correctement supprimée !
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal pour affichage du message de confirmation suppression vidéo  -->
    <div class="modal fade" id="videoDeletedModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    Vidéo correctement supprimée !
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                </div>
            </div>
        </div>
    </div>


    <div class="row no-gutters justify-content-center" style="background-image:url('{{ asset('images/cover.jpg') }}')">
        <div id="trickDetails" class="row col-md-8 justify-content-center" data-defaultcover="{{ asset('images/default_cover.jpg') }}">
            <div class="card rounded">
                <form method="post" enctype="multipart/form-data">
                {% if is_granted('ROLE_USER') %} <!-- on affiche les liens edit/suppression seulement si on est connecté -->
                    <div class="card-img-overlay" id="editDeleteLinks" data-pictureid="{% if ((trick.pictures | length) == 0) %}cover{% else %}{%  for picture in trick.pictures %}{% if loop.first %}{{ picture.id }}{%  endif %}{% endfor %}{% endif %}">
                        <h5 class="card-title text-right"><a id="coverTrickEdit" title="Modifier l'image de couverture"><i class="btn btn-info fas fa-pen-fancy"></i></a> <a id="coverTrickDelete" title="Supprimer l'image de couverture"><i class="btn btn-info fas fa-trash-alt"></i></a></h5>
                    </div>
                {% endif %}

                <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                <img src="
                {% if ((trick.pictures | length) == 0) %} {{ asset('images/default_cover.jpg') }}
                {% else %} {%  for picture in trick.pictures %} {% if loop.first %}{{ asset(picture.path) }}{%  endif %} {% endfor %}
                {% endif %}
                " class="card-img-top-trickCover border-bottom border-dark" alt="{{ trick.name }}">

                <div class="card-body">
                    {% if error %}
                        <div class="form-group row formErrorMessage justify-content-center align-items-center text-center">{{ error }}</div>
                    {% endif %}
                    <!-- Bloc des images/vidéos pour affichage écran standard -->
                    <div class="d-none d-sm-none d-md-none d-lg-block trickMediaEditBlock">
                        <div class="row justify-content-left align-items-center">
                            {% if ((trick.pictures | length) == 0 and (trick.videos | length) == 0) %}
                                <p>Aucun média pour cette figure !</p>
                            {% else %}
                                {% if ((trick.pictures | length) > 0) %}
                                    {%  for picture in trick.pictures %}
                                        <div class="col-lg-2 card rounded text-center">
                                            <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                                            <a href="{{ asset(picture.path) }}" title="Agrandir l'image"><img src="{{ asset(picture.path) }}" class="card-img-top" alt="{{ trick.name }}"></a>
                                            <br/>{% if loop.first %}<span>A la une</span>{% else %}<span><a class="trickPictureEdit" title="Remplacer cette image" id="{{ picture.id }}"><i class="fas fa-pen-fancy"></i></a> | <a class="trickPictureDelete" title="Supprimer cette image" data-pictureid="{{ picture.id }}"><i class="fas fa-trash-alt"></i></a></span>{% endif %}
                                        </div>
                                    {% endfor %}
                                {% endif %}

                                {% if ((trick.videos | length) > 0) %}
                                    {%  for video in trick.videos %}
                                        <div class="col-lg-2 card h-100 rounded text-center">
                                            <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                                            <embed src="{{ asset(video.url) }}" class="card-img-top" alt="{{ trick.name }}">
                                            <br/><span><a data-videourl="{{ video.url }}" class="trickVideoEdit" title="Remplacer cette vidéo" id="{{ video.id }}"><i class="fas fa-pen-fancy"></i></a> | <a class="trickVideoDelete" title="Supprimer cette vidéo" data-videoid="{{ video.id }}"><i class="fas fa-trash-alt"></i></a></span>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            {% endif %}

                            <div class="col-lg-2 card rounded text-center">
                                <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                               <span>Ajouter un média :<br /><a class="trickPictureAdd" title="Ajouter une image"><i class="fas fa-camera-retro fa-3x"></i></a>   <a class="trickVideoAdd" title="Ajouter une vidéo"><i class="fas fa-video fa-3x"></i></a></span>
                            </div>
                        </div>
                    </div>

                    <!-- Bloc images/vidéos pour affichage mobile -->
                    <div class="d-block d-lg-none trickMediaEditBlockMobile">
                        <div class="row justify-content-center align-items-center" id="trickMediasMobileBlock" style="display:none;">
                            {% if ((trick.pictures | length) == 0 and (trick.videos | length) == 0) %}
                                <p>Aucun média pour cette figure !</p>
                            {% else %}
                                {% if ((trick.pictures | length) > 0) %}
                                    {%  for picture in trick.pictures %}
                                        <div class="card h-100 rounded text-center" id="trickMediasMobile">
                                            <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                                            <a data-media="{{ asset(picture.path) }}" data-toggle="modal" data-target="#exampleModal" title="Agrandir l'image"><img src="{{ asset(picture.path) }}" class="card-img-top" alt="{{ trick.name }}"></a>
                                            <br/>{% if loop.first %}<span>A la une</span>{% else %}<span><a class="trickPictureEdit" title="Remplacer cette image" id="{{ picture.id }}"><i class="fas fa-pen-fancy"></i></a> | <a class="trickPictureDelete" title="Supprimer cette image" data-pictureid="{{ picture.id }}"><i class="fas fa-trash-alt"></i></a></span>{% endif %}
                                        </div>
                                    {% endfor %}
                                {% endif %}

                                {% if ((trick.videos | length) > 0) %}
                                    {%  for video in trick.videos %}
                                        <div class="card h-100 rounded text-center" id="trickMediasMobile">
                                            <!-- si on a aucune image associée à la figure alors on affiche l'image par défault, sinon on affiche la première image enregistrée en bdd pour ce trick -->
                                            <iframe src="{{ asset(video.url) }}" class="card-img-top" alt="{{ trick.name }}"></iframe>
                                            <br/><span><a data-videourl="{{ video.url }}" class="trickVideoEdit" title="Remplacer cette vidéo" id="{{ video.id }}"><i class="fas fa-pen-fancy"></i></a> | <a class="trickVideoDelete" title="Supprimer cette vidéo" data-videoid="{{ video.id }}"><i class="fas fa-trash-alt"></i></a></span>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            {% endif %}
                            <div class="card h-100 rounded text-center" id="trickMediasMobile">
                                <span>Ajouter un média :<br /><a class="trickPictureAdd" title="Ajouter une image"><i class="fas fa-camera-retro fa-3x"></i></a>   <a class="trickVideoAdd" title="Ajouter une vidéo"><i class="fas fa-video fa-3x"></i></a></span>
                            </div>
                        </div>
                        <div class="row justify-content-center align-items-center"><span class="btn btn-info" id="showMediasLink">Voir les médias</span></div>
                        <div class="row justify-content-center align-items-center"><span class="btn btn-info" id="hideMediasLink" style="display:none;">Cacher les médias</span></div>
                    </div>

                    <hr>
                    <div class="row justify-content-center text-center">
                        <div class="col-md-3"><b>Détails : </b></div>
                        <div class="col-md-3"><b>{{ trick.authorName.username }}</b></div>
                        <div class="col-md-3"><b>Publiée le : {{ trick.publishedAt|date('d-m-Y H:i') }}</b></div>
                        <div class="col-md-3"><b>Modifiée le : {{ trick.updatedAt|date('d-m-Y H:i') }}</b></div>
                    </div>
                    <hr><br />
                    <div class="justify-content-center text-center">
                            <div class="form-group row">
                                <label for="name" class="col-md-4 col-form-label">Nom de la figure :</label>
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="name" name="name" placeholder="Nom de figure" value="{{ trick.name }}" required minlength="2" maxlength="50">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="description" class="col-md-4 col-form-label">Description :</label>
                                <div class="col-md-8">
                                    <textarea class="form-control" id="description" name="description" required rows="10">{{ trick.description }}</textarea>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="category" class="col-md-4 col-form-label">Catégorie :</label>
                                <div class="col-md-8">
                                    <select class="form-control" id="category" name="category">
                                        {% for category in categories %}
                                            <option value="{{ category.id }}" {% if (category.id == trick.category.id) %} selected {% endif %}>{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="form-group row justify-content-center text-center">
                                <button id="sumbitButtonEditTrick" type="submit" class="btn btn-info btn-circle"><i class="fas fa-check fa-2x"></i></button>
                                <a data-toggle="modal" data-target="#deleteConfirmModal" data-deletepath="{{ path('trick_delete', {'trickId': trick.id}) }}" href="" title="Supprimer la figure"><button class="btn btn-danger btn-circle"><i class="fas fa-trash-alt"></i></button></a>
                            </div>

                            <input type="text" id="pictureNb" name="pictureNb" value="0" style="display: none;"/>
                            <input type="text" id="pictureAddNb" name="pictureAddNb" value="0" style="display: none;"/>
                            <input type="text" id="videoNb" name="videoNb" value="0" style="display: none;"/>
                            <input type="text" id="videoAddNb" name="videoAddNb" value="0" style="display: none;"/>
                            <input type="text" id="picturesToDelete" name="picturesToDelete" value="" style="display:none;"/>
                            <input type="text" id="videosToDelete" name="videosToDelete" value="" style="display:none;"/>
                            <input type="text" id="picturesToEdit" name="picturesToEdit" value="" style="display:none;"/>
                            <input type="text" id="videosToEdit" name="videosToEdit" value="" style="display:none;"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/editMedias.js') }}"></script>
{%  endblock %}